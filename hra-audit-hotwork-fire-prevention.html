<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes" />
  
  <title>HRA AUDIT - Hot Work & Fire Prevention</title>
  <meta name="description" content="Digital Field Audit Form for Hot Work and Fire Prevention activities to support safe operations, permit-to-work systems, and compliance with safety standards and fire prevention regulations (NFPA/OSHA)." />
  <meta name="keywords" content="HRA Audit, Hot Work, Fire Prevention, Permit to Work, Safety Inspection, Construction, HSE, Virsim, Iwan Kurniawan, K3, Inspection Form, Digital Audit" />
  <meta name="author" content="Virsim & Iwan Kurniawan" />
  <meta name="theme-color" content="#0284c7" />

  <link rel="icon" type="image/webp" href="https://hra-virsim.pages.dev/img/virsim_red.webp" />

  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://hra-virsim.pages.dev/" />
  <meta property="og:title" content="HRA Audit ‚Äì Hot Work & Fire Prevention" />
  <meta property="og:description" content="Interactive digital audit form for Hot Work & Fire Prevention, designed for construction & operation sites to support High Risk Activity management." />
  <meta property="og:image" content="https://hra-virsim.pages.dev/img/hra-hotwork-og.webp" />

  <style>
    :root{
      --bg:#020617;
      --bg-soft:#020617;
      --card:#020617;
      --card-soft:#020617;
      --ink:#0f172a;
      --muted:#64748b;
      --accent:#0ea5e9;
      --accent-soft:#0ea5e920;
      --accent-2:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --line:#1e293b;
      --chip:#0ea5e914;
    }

    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Inter","Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1e293b 0,#020617 55%);
      color:#e5e7eb;
      min-height:100vh;
      padding:24px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    @media (max-width: 768px){
      body{padding:16px}
    }

    main{
      max-width:1200px;
      width:100%;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    .shell{
      background:radial-gradient(circle at top left,rgba(56,189,248,.18),rgba(15,23,42,1) 58%);
      border-radius:24px;
      padding:20px 20px 24px;
      border:1px solid rgba(148,163,184,.4);
      box-shadow:
        0 18px 45px -25px rgba(15,23,42,0.9),
        0 0 0 1px rgba(148,163,184,0.4);
      position:relative;
      overflow:hidden;
    }

    .shell::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:
        radial-gradient(circle at 10% 0%,rgba(56,189,248,.36),transparent 55%),
        radial-gradient(circle at 90% -10%,rgba(74,222,128,.24),transparent 55%);
      opacity:.7;
      mix-blend-mode:screen;
      pointer-events:none;
    }

    .shell::after{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at top,#0f172a66,transparent 50%);
      mix-blend-mode:multiply;
      pointer-events:none;
    }

    .shell > *{position:relative;z-index:1}

    .hero{
      display:flex;
      gap:18px;
      align-items:flex-start;
    }
    @media (max-width: 780px){
      .hero{flex-direction:column;align-items:flex-start}
    }

    .hero .logo-wrap{
      position:relative;
      width:82px;height:82px;
      flex:0 0 auto;
      display:flex;align-items:center;justify-content:center;
      border-radius:26px;
      background:radial-gradient(circle at 20% 0%,#e11d4860,#020617);
      box-shadow:
        0 18px 40px -35px rgba(15,23,42,1),
        0 0 0 1px rgba(248,250,252,0.16);
      overflow:hidden;
    }
    .hero .logo-wrap::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(circle at 15% 0%,rgba(248,250,252,.8),transparent 55%),
        radial-gradient(circle at 80% 120%,rgba(96,165,250,.7),transparent 45%);
      opacity:.9;
      mix-blend-mode:soft-light;
      pointer-events:none;
    }
    .hero .logo-wrap::after{
      content:"";
      position:absolute;
      inset:6px;
      border-radius:22px;
      border:1px solid rgba(248,250,252,.35);
      box-shadow:
        inset 0 0 0 1px rgba(248,250,252,.12),
        0 0 0 1px rgba(15,23,42,.8);
      pointer-events:none;
    }
    .hero .logo-inner{
      position:relative;
      width:100%;height:100%;
      display:flex;align-items:center;justify-content:center;
    }
    .hero .logo-inner img{
      max-width:70%;max-height:70%;
      object-fit:contain;
      filter:drop-shadow(0 0 10px rgba(15,23,42,.9));
      transform:translateY(1px);
    }
    .logo-orbit{
      position:absolute;
      inset:-10px;
      border-radius:999px;
      border:1px solid rgba(248,250,252,.22);
      border-left-color:rgba(56,189,248,.8);
      border-bottom-color:rgba(34,197,94,.9);
      box-shadow:
        0 0 0 1px rgba(15,23,42,.9),
        0 0 18px rgba(56,189,248,.6);
      animation:spin 14s linear infinite;
      pointer-events:none;
    }
    .logo-orbit::before{
      content:"";
      position:absolute;
      width:12px;height:12px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 0%,#f9fafb,rgba(59,130,246,1));
      box-shadow:0 0 18px rgba(59,130,246,.85);
      top:-6px;left:45%;
    }
    @keyframes spin{
      to{transform:rotate(360deg);}
    }

    .hero .title{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:4px;
      color:#e5e7eb;
    }
    .hero .title h1{
      font-size:1.45rem;
      letter-spacing:.04em;
      text-transform:uppercase;
      font-weight:800;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .hero .title h1 span.label{
      font-size:.8rem;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      background:rgba(15,23,42,.8);
      text-transform:none;
      font-weight:500;
      color:#e5e7eb;
    }
    .hero .title h1 img{
      width:18px;height:18px;
      object-fit:contain;
      align-self:flex-start;
      margin-bottom:12px;
      filter:drop-shadow(0 4px 8px rgba(0,0,0,0.15));
      background:rgba(255,255,255,0.95);
      padding:12px;
      border-radius:50%;
      transition:all 0.3s ease;
    }

    .hero .title h1 span{
      display:inline-flex;align-items:center;gap:6px;
      font-size:.8rem;font-weight:500;padding:4px 9px;
      border-radius:999px;background:#0b112033;border:1px solid #bae6fd3b;
      vertical-align:middle;
    }
    .hero .meta{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .meta .chip{
      background:#ffffff24;color:#f9fafb;padding:8px 12px;border-radius:999px;font-weight:500;
      display:flex;align-items:center;gap:8px;backdrop-filter:saturate(140%) blur(4px);
      border:1px solid #bae6fd3b;font-size:.88rem;
    }
    .meta .chip label{opacity:.9;font-weight:400;font-size:0.8rem}

    .lang-switch {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 10;
      background: rgba(0,0,0,0.3);
      border-radius: 999px;
      padding: 4px;
      display: inline-flex;
      align-items: center;
      gap: 2px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148,163,184,0.6);
      box-shadow: 0 10px 25px rgba(15,23,42,0.8);
    }
    .lang-switch button{
      border-radius: 999px;
      padding-inline: 10px;
      font-size: 0.8rem;
      background: transparent;
      border: none;
      color: #cbd5f5;
      opacity: .6;
      font-weight: 500;
      cursor: pointer;
      min-height: 28px;
    }
    .lang-switch button.active{
      background: rgba(15,23,42,0.85);
      opacity: 1;
      color:#f9fafb;
      box-shadow: 0 0 0 1px rgba(148,163,184,0.9), 0 6px 10px rgba(15,23,42,0.8);
    }

    .hero p.desc{
      font-size:.9rem;color:#cbd5e1;margin-top:6px;max-width:620px;
    }

    .hero-aside{
      display:flex;flex-direction:column;gap:8px;align-items:flex-end;
      font-size:.78rem;color:#e5e7eb;
    }
    @media (max-width: 780px){
      .hero-aside{align-items:flex-start}
    }
    .hero-aside .tag{
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(148,163,184,.55);
      background:rgba(15,23,42,.8);
      display:flex;align-items:center;gap:8px;
    }
    .hero-aside .tag span.icon-circle{
      width:18px;height:18px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      font-size:.7rem;
      background:radial-gradient(circle at 30% 0%,#22c55e,#15803d);
      box-shadow:0 0 10px rgba(34,197,94,.8);
      color:#ecfdf5;
    }
    .hero-aside .sub{
      opacity:.75;max-width:260px;text-align:right;
    }
    @media (max-width: 780px){
      .hero-aside .sub{text-align:left}
    }

    .pill-bar{
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    .pill{
      border-radius: 999px;
      padding: 4px 9px;
      border: 1px solid rgba(148,163,184,.5);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      opacity: .8;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .pill span.dot{
      width: 6px; height: 6px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,.9);
    }

    .toolbar-shell{
      margin-top:14px;
      position:sticky;top:10px;z-index:5;
      background:linear-gradient(to bottom,rgba(15,23,42,.96),rgba(15,23,42,.92));
      backdrop-filter:blur(14px);
      border-radius:18px;
      border:1px solid rgba(148,163,184,.6);
      box-shadow:0 16px 35px -20px rgba(15,23,42,1);
      padding:10px;
    }
    .toolbar{
      display:flex;flex-wrap:wrap;gap:10px;
      align-items:center;justify-content:space-between;
    }
    .toolbar .left,.toolbar .right{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
    }

    .toolbar-label{
      font-size:0.72rem;color:#cbd5e1;text-transform:uppercase;letter-spacing:.08em;
      opacity:.8;font-weight:600;
    }

    .toolbar .input-row{
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;
    }

    .toolbar input[type="text"],.toolbar input[type="date"], .toolbar select {
      background:rgba(15,23,42,0.9);
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.9);
      color:#e5e7eb;
      padding:6px 12px;
      font-size:0.8rem;
      min-height:34px;
    }
    .toolbar input::placeholder{
      color:#94a3b8;
    }

    .toolbar .badge{
      padding:4px 8px;border-radius:999px;font-size:0.75rem;
      background:rgba(15,23,42,0.85);border:1px solid rgba(148,163,184,0.8);
      color:#e5e7eb;display:flex;align-items:center;gap:6px;
    }
    .badge-dot{
      width:8px;height:8px;border-radius:999px;
      background:radial-gradient(circle at 30% 0%,#22c55e,#15803d);
      box-shadow:0 0 10px rgba(34,197,94,.8);
    }

    .toolbar .actions{
      display:flex;gap:8px;
    }
    .toolbar button{
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.9);
      background:rgba(15,23,42,0.98);
      color:#e5e7eb;
      padding:6px 12px;
      font-size:0.8rem;
      display:inline-flex;align-items:center;gap:6px;
      cursor:pointer;
      min-height:34px;
      box-shadow:0 10px 20px -12px rgba(15,23,42,1);
      transition:all 0.18s ease;
    }
    .toolbar button span.icon{
      font-size:0.9rem;
    }
    .toolbar button:hover{
      background:#0ea5e9;
      border-color:#38bdf8;
      color:#0f172a;
      box-shadow:0 15px 25px -15px rgba(56,189,248,.8);
      transform:translateY(-1px);
    }
    .toolbar button.toggle-active{
      background:#22c55e;
      border-color:#4ade80;
      color:#022c22;
      box-shadow:0 16px 30px -18px rgba(34,197,94,.9);
    }

    .toolbar .search-wrap{
      display:flex;align-items:center;gap:8px;
      background:rgba(15,23,42,0.95);
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.9);
      padding:4px 10px 4px 8px;
      min-height:34px;
    }
    .toolbar .search-wrap span{
      font-size:0.9rem;opacity:.7;
    }
    .toolbar .search-wrap input{
      border:none;background:transparent;outline:none;color:#e5e7eb;
      font-size:0.8rem;min-width:150px;
    }

    .score-bar{
      margin-top:14px;
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:18px;
      align-items:center;
    }
    .score-kpi{
      background:linear-gradient(to bottom right,rgba(15,23,42,.95),rgba(15,23,42,1));
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.9);
      padding:10px 12px;
      display:flex;gap:8px;align-items:stretch;
      box-shadow:0 16px 30px -20px rgba(15,23,42,1);
    }
    .score-kpi .kpi{
      flex:1;display:flex;flex-direction:column;gap:2px;
      align-items:flex-start;justify-content:center;
    }
    .score-label{
      font-size:.75rem;color:#e2e8f0;opacity:.9;
    }
    .score-value{
      font-size:1.1rem;font-weight:800;color:#f9fafb;
    }
    .score-rating{
      font-size:.72rem;opacity:.8;margin-top:2px;
      text-transform:uppercase;letter-spacing:.08em;
    }

    .progress{
      position:relative;height:8px;border-radius:999px;
      background:rgba(15,23,42,1);
      border:1px solid rgba(148,163,184,0.8);
      overflow:hidden;
      box-shadow: inset 0 0 8px rgba(15,23,42,0.9);
      margin-bottom:8px;
    }
    .progress span{
      position:absolute;inset:0;left:0;width:0%;
      border-radius:999px;
      background:linear-gradient(to right,#22c55e,#a3e635);
      box-shadow:0 0 15px rgba(34,197,94,.65);
      transition:width .25s ease-out;
    }

    .global-summary{
      font-size:.78rem;color:#e5e7eb;opacity:.85;
    }

    .grid{
      display:grid;grid-template-columns:repeat(3,1fr);gap:16px;
    }
    @media (max-width: 1200px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width: 700px){ .grid{grid-template-columns:1fr} }

    .card{
      border:1px solid #1e293b;border-radius:18px;background:radial-gradient(circle at top left,rgba(30,64,175,.45),rgba(15,23,42,1) 55%);
      display:flex;flex-direction:column;
      box-shadow:0 10px 24px -16px rgba(15,23,42,1);
      transition:all .2s cubic-bezier(0.4,0,0.2,1);
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:
        radial-gradient(circle at 10% -5%,rgba(56,189,248,.3),transparent 55%),
        radial-gradient(circle at 90% 110%,rgba(34,197,94,.28),transparent 55%);
      opacity:.8;
      mix-blend-mode:screen;
      pointer-events:none;
    }
    .card::after{
      content:"";
      position:absolute;inset:0;
      background:radial-gradient(circle at top,rgba(15,23,42,.85),transparent 52%);
      mix-blend-mode:multiply;pointer-events:none;
    }
    .card > *{position:relative;z-index:1}
    .card:hover{
      transform:translateY(-3px);
      box-shadow:0 18px 40px -25px rgba(15,23,42,1);
      border-color:#38bdf8;
    }
    .card.issue{
      border-color:#fb923c;
      box-shadow:0 0 0 1px #fb923c, 0 16px 35px -22px rgba(248,113,22,0.95);
    }
    body.issues-on .card{opacity:.28;pointer-events:none;}
    body.issues-on .card.issue{opacity:1;pointer-events:auto;}

    .card .head{
      padding:14px 14px 0;display:flex;justify-content:space-between;align-items:flex-start;
      gap:10px;
    }
    .card .title{
      display:flex;flex-direction:column;gap:2px;flex:1;
    }
    .card h2{
      font-size:.9rem;color:#f9fafb;font-weight:600;
    }
    .card .subtitle{
      font-size:.76rem;color:#cbd5e1;opacity:.95;
    }

    .badge{
      font-size:.7rem;border-radius:999px;padding:4px 8px;
      display:inline-flex;align-items:center;gap:5px;
      border:1px solid rgba(148,163,184,.85);background:rgba(15,23,42,.9);
      color:#e5e7eb;
    }
    .badge::before{content:"‚óè";font-size:.6rem;}
    .possible{color:#22c55e;background:rgba(22,163,74,.18);border-color:#4ade80}
    .na{color:#f97316;background:rgba(251,146,60,.18);border-color:#fdba74}

    .body{
      padding:10px 14px 12px;
      display:flex;flex-direction:column;gap:8px;font-size:.82rem;
    }
    .body p{color:#e5e7eb;}
    .body label{font-size:.78rem;color:#e5e7eb;opacity:.9;}

    .status-row{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .status-row select{
      flex:1;
    }
    .score-row{
      display:flex;align-items:center;gap:8px;
    }
    .score-row input{
      width:68px;text-align:center;font-weight:600;
    }
    .score-row .possible-text{
      font-size:.74rem;color:#e5e7eb;opacity:.8;
    }

    textarea{
      width:100%;resize:vertical;min-height:70px;
      border-radius:12px;border:1px solid rgba(148,163,184,0.9);
      padding:8px 10px;
      background:rgba(15,23,42,0.95);
      color:#e5e7eb;
      font-size:.8rem;
    }
    textarea::placeholder{color:#94a3b8;}

    .photo-row{
      display:flex;align-items:center;justify-content:space-between;gap:8px;
      font-size:.8rem;color:#cbd5e1;
    }

    .photo-row button{
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.9);
      background:rgba(15,23,42,0.98);
      color:#e5e7eb;
      padding:5px 10px;
      font-size:.76rem;
      display:inline-flex;align-items:center;gap:6px;
      cursor:pointer;
    }
    .photo-row button:hover{
      background:#0ea5e9;border-color:#38bdf8;color:#0f172a;
    }

    .footer-note{
      margin-top:12px;
      font-size:.78rem;
      color:#cbd5e1;
      opacity:.9;
    }

    @media (max-width: 880px){
      .hero{flex-direction:column;}
      .hero-aside{align-items:flex-start;text-align:left}
      .score-bar{grid-template-columns:1fr;gap:16px;}
      .score-kpi{order:2}
    }

    @media (max-width: 768px) {
      .toolbar-shell {
        position: relative !important;
        top: auto;
        margin-top: 10px; margin-bottom: 20px;
        backdrop-filter: none; padding-top: 0;
      }
      .toolbar {
        border-radius: 16px; padding: 12px;
        gap: 12px; flex-direction: column; align-items: stretch;
      }
      .toolbar-group { width: 100%; justify-content: space-between; }
      .toolbar-group small { display: block; width: 100%; margin-bottom: 4px; }
      .toolbar-group input, .toolbar-group select { flex: 1; width: 100%; }
      .toolbar > button { flex: 1; justify-content: center; }

      .score-bar { grid-template-columns: 1fr; gap: 20px; }
      .score-kpi { justify-content: space-between; gap: 8px; }
      .score-kpi .kpi { flex: 1; text-align: center; padding: 8px; min-width: auto; }
      
      .cat-head { flex-direction: column; align-items: flex-start; gap: 12px; }
      .cat-meta-right { width: 100%; justify-content: space-between; }
      
      .hero .title {
        align-items: center;
        text-align: center;
      }
      .hero-aside {
        align-items: center;
        text-align: center;
      }
      .hero .meta {
        justify-content: center;
      }
    }

  </style>
</head>
<body>

<main>
  <div class="shell">
    <div class="lang-switch">
      <button type="button" id="btnLangEn" class="active">EN</button>
      <button type="button" id="btnLangId">ID</button>
    </div>

    <section class="hero">
      <div class="hero .logo-wrap">
        <div class="logo-wrap">
          <div class="logo-inner">
            <img src="https://hra-virsim.pages.dev/img/virsim_red.webp" alt="Virsim Logo">
          </div>
          <div class="logo-orbit"></div>
        </div>
      </div>

      <div class="title">
        <h1>
          <span>HRA AUDIT</span>
          <span class="label">Hot Work &amp; Fire Prevention</span>
        </h1>
        <p class="desc" id="heroDesc">
          Digital field checklist for High Risk Activity (HRA) audits related to Hot Work &amp; Fire Prevention during construction and operation. 
          Designed to support permit-to-work systems, fire readiness, and continuous learning for project teams.
        </p>
        <div class="meta">
          <div class="chip">
            <label id="chipScopeLabel">Scope</label>
            <span id="chipScopeText">Construction &amp; Operation phase</span>
          </div>
          <div class="chip">
            <label id="chipProgramLabel">Program</label>
            <span id="chipProgramText">Sustainability learning &amp; development</span>
          </div>
          <div class="chip">
            <label id="chipOwnerLabel">Owner</label>
            <span id="chipOwnerText">Health, Safety &amp; Environmental (HSE)</span>
          </div>
        </div>
        <div class="pill-bar">
          <div class="pill">
            <span class="dot"></span>
            <span id="pillHraText">High Risk Activity (HRA)</span>
          </div>
          <div class="pill">
            <span class="dot"></span>
            <span id="pillComplianceText">Permit to Work &amp; Compliance</span>
          </div>
          <div class="pill">
            <span class="dot"></span>
            <span id="pillLearningText">Continuous Learning Culture</span>
          </div>
        </div>
      </div>

      <aside class="hero-aside">
        <div class="tag">
          <span class="icon-circle">‚ö°</span>
          <span id="tagLabel">HRA: Hot Work ‚Äì Sparks, Flames, Fire Prevention</span>
        </div>
        <div class="sub" id="tagSub">
          A modern digital checklist to verify that Hot Work activities are properly prepared, protected, supervised, and documented.
        </div>
      </aside>
    </section>

    <div class="toolbar-shell">
      <div class="toolbar">
        <div class="left">
          <div class="input-row">
            <span class="toolbar-label" id="lbl_identity">Audit Identity</span>
            <input id="inputAuditor" type="text" placeholder="Auditor name" />
            <input id="inputDate" type="date" />
            <span class="badge">
              <span class="badge-dot"></span>
              <span id="badge_info">Live scoring</span>
            </span>
          </div>
        </div>

        <div class="right">
          <div class="input-row">
            <div class="search-wrap">
              <span>üîç</span>
              <input id="inputSearch" type="text" placeholder="Search item..." />
            </div>

            <select id="filterCategory">
              <option value="all">All categories</option>
            </select>

            <select id="filterStatus">
              <option value="all">All status</option>
              <option value="complete">Completed</option>
              <option value="na">N/A only</option>
              <option value="empty">Not yet rated</option>
            </select>

            <button class="icon" id="btnIssues" title="Highlight findings  & issues">
              <span class="icon">‚ö†Ô∏è</span>
              <span id="btn_issues">Highlight Issues</span>
            </button>

            <button class="icon" id="btnSave" title="Save to server">
              <span class="icon">üíæ</span>
              <span id="btn_save">Save</span>
            </button>

            <button class="icon" id="btnPrint" title="Print / Save as PDF for documentation">
              <span class="icon">üñ®Ô∏è</span>
              <span id="btn_print">Print</span>
            </button>

            <button class="icon" id="btnExportCsv" title="Export CSV">
              <span class="icon">üì§</span>
              <span id="btn_csv">CSV</span>
            </button>

            <button class="icon" id="btnReset" title="Reset all data">
              <span class="icon">‚ôªÔ∏è</span>
              <span id="btn_reset">Reset</span>
            </button>
          </div>
        </div>
      </div>

      <div class="score-bar">
        <div class="score-kpi">
          <div class="kpi">
            <div class="score-label" id="kpi_possible">Possible</div>
            <div class="score-value" id="kpiPossible">0</div>
          </div>
          <div class="kpi">
            <div class="score-label" id="kpi_actual">Actual</div>
            <div class="score-value" id="kpiActual">0</div>
          </div>
          <div class="kpi">
            <div class="score-label" id="kpi_score">Score</div>
            <div class="score-value" id="kpiPct">0%</div>
            <div class="score-rating" id="kpiRating">‚Äî</div>
          </div>
        </div>
        <div>
          <div class="progress"><span id="progressFill" style="width:0%"></span></div>
          <div class="global-summary" id="globalSummary"></div>
        </div>
      </div>
    </div>
  </div>

  <section id="cardsSection" class="grid">
    <!-- Cards will be rendered here -->
  </section>

  <p class="footer-note" id="footerNote">
    Note: If an item is marked as N/A (Not Applicable), please provide a clear justification in the findings text box.
  </p>
</main>

<script>
  const API_SAVE_URL =
    'https://script.google.com/macros/s/AKfycbzBWaYo5AEqMe3KL6rG6AGfPLzcqv0sAXuRJUJUkivw-Bc4ZoMNcurtv2edFsP3uX7W/exec';

  // ========= Translation Dictionary =========
  const TRANSLATIONS = {
    id: {
      title: "HRA AUDIT ‚Äî Hot Work & Fire Prevention",
      lbl_auditor: "Auditor:",
      lbl_date: "Tanggal:",
      btn_print: "Cetak",
      btn_csv: "CSV",
      btn_reset: "Reset",
      kpi_possible: "Maksimal",
      kpi_actual: "Aktual",
      kpi_score: "Skor",
      lbl_filter: "Filter & Pencarian",
      input_search: "Cari item...",
      all_cat: "Semua Kategori",
      all_stat: "Semua Status",
      stat_complete: "Sudah dinilai",
      stat_na: "Ditandai N/A",
      stat_empty: "Belum diisi",
      lbl_identity: "Identitas Audit",
      input_auditor_ph: "Nama Auditor",
      btn_save: "Simpan",
      btn_issues: "Sorot Masalah",
      footer_note: "Catatan: Jika item ditandai N/A (Not Applicable) harap isi justifikasi pada kolom temuan.",
      card_actual: "Poin Aktual",
      card_status: "Status",
      card_findings: "Temuan & Bukti",
      card_findings_ph: "Catatan temuan...",
      card_photo: "Foto Bukti",
      card_photo_btn: "+ Foto",
      status_note: "Status:",
      opt_app: "Applicable",
      opt_na: "N/A (butuh justifikasi)",
      badge_poss_na: "Possible: N/A",
      msg_saved: "Data tersimpan.",
      msg_max: "Maksimal poin adalah",
      msg_neg: "Tidak boleh negatif",
      msg_export: "Item N/A wajib memiliki catatan temuan:",
      rating_excellent: "Sangat Baik",
      rating_good: "Baik",
      rating_need_improvement: "Perlu Perbaikan",
      rating_critical: "Kritis",
      hero_desc: "Checklist digital lapangan untuk audit High Risk Activity (HRA) terkait Hot Work & Fire Prevention pada fase konstruksi dan operasi. Dirancang untuk mendukung sistem izin kerja, kesiapsiagaan kebakaran, dan pembelajaran berkelanjutan bagi tim proyek.",
      chip_scope_label: "Ruang Lingkup",
      chip_scope_text: "Fase konstruksi & operasi",
      chip_program_label: "Program",
      chip_program_text: "Sustainability learning & development",
      chip_owner_label: "Pemilik",
      chip_owner_text: "Health, Safety & Environmental (HSE)",
      pill_hra_text: "High Risk Activity (HRA)",
      pill_compliance_text: "Permit to Work & Kepatuhan",
      pill_learning_text: "Budaya Pembelajaran Berkelanjutan",
      tag_label: "HRA: Hot Work ‚Äì Percikan Api, Api Terbuka, Pencegahan Kebakaran",
      tag_sub: "Checklist digital modern untuk memastikan aktivitas Hot Work dipersiapkan, dilindungi, diawasi, dan didokumentasikan dengan baik.",
      badge_info: "Skor hidup",
      btn_issues_label: "Sorot Masalah",
      btn_save_label: "Simpan",
      btn_print_label: "Cetak",
      btn_csv_label: "CSV",
      btn_reset_label: "Reset",
      filter_all_cat: "Semua kategori",
      filter_all_stat: "Semua status",
      filter_complete: "Sudah dinilai",
      filter_na: "Hanya N/A",
      filter_empty: "Belum diisi",
      global_summary: (actual, possible, pct, rating) =>
        `Total aktual ${actual} dari maksimal ${possible} poin. Skor ${pct}% (${rating}).`,
    },
    en: {
      title: "HRA AUDIT ‚Äî Hot Work & Fire Prevention",
      lbl_auditor: "Auditor:",
      lbl_date: "Date:",
      btn_print: "Print",
      btn_csv: "CSV",
      btn_reset: "Reset",
      kpi_possible: "Possible",
      kpi_actual: "Actual",
      kpi_score: "Score",
      lbl_filter: "Filter & Search",
      input_search: "Search item...",
      all_cat: "All categories",
      all_stat: "All status",
      stat_complete: "Completed",
      stat_na: "Marked N/A",
      stat_empty: "Not rated",
      lbl_identity: "Audit Identity",
      input_auditor_ph: "Auditor name",
      btn_save: "Save",
      btn_issues: "Highlight Issues",
      footer_note: "Note: If an item is marked as N/A (Not Applicable), please provide justification in the findings text box.",
      card_actual: "Actual Point",
      card_status: "Status",
      card_findings: "Findings & Evidence",
      card_findings_ph: "Findings notes...",
      card_photo: "Photo Evidence",
      card_photo_btn: "+ Photo",
      status_note: "Status:",
      opt_app: "Applicable",
      opt_na: "N/A (requires justification)",
      badge_poss_na: "Possible: N/A",
      msg_saved: "Data saved.",
      msg_max: "Maximum point is",
      msg_neg: "Cannot be negative",
      msg_export: "N/A items must have findings note:",
      rating_excellent: "Excellent",
      rating_good: "Good",
      rating_need_improvement: "Need improvement",
      rating_critical: "Critical",
      hero_desc: "Digital field checklist for High Risk Activity (HRA) audits related to Hot Work & Fire Prevention during construction and operation. Designed to support permit-to-work systems, fire readiness, and continuous learning for project teams.",
      chip_scope_label: "Scope",
      chip_scope_text: "Construction & Operation phase",
      chip_program_label: "Program",
      chip_program_text: "Sustainability learning & development",
      chip_owner_label: "Owner",
      chip_owner_text: "Health, Safety & Environmental (HSE)",
      pill_hra_text: "High Risk Activity (HRA)",
      pill_compliance_text: "Permit to Work & Compliance",
      pill_learning_text: "Continuous Learning Culture",
      tag_label: "HRA: Hot Work ‚Äì Sparks, Flames, Fire Prevention",
      tag_sub: "A modern digital checklist to ensure Hot Work activities are properly prepared, protected, supervised and documented.",
      badge_info: "Live scoring",
      btn_issues_label: "Highlight Issues",
      btn_save_label: "Save",
      btn_print_label: "Print",
      btn_csv_label: "CSV",
      btn_reset_label: "Reset",
      filter_all_cat: "All categories",
      filter_all_stat: "All status",
      filter_complete: "Completed",
      filter_na: "N/A only",
      filter_empty: "Not yet rated",
      global_summary: (actual, possible, pct, rating) =>
        `Actual ${actual} out of ${possible} possible points. Score ${pct}% (${rating}).`,
    }
  };

  const CATEGORIES = [
    {
      key: 'planning',
      name_en: 'Planning & Permit Control',
      name_id: 'Perencanaan & Kontrol Izin',
      items: [
        {docNo:1,
         text_en:'Hot Work Permit is issued, valid, and clearly displayed at the work location.',
         text_id:'Izin Hot Work diterbitkan, masih berlaku, dan ditampilkan dengan jelas di lokasi kerja.',
         possible:3},
        {docNo:2,
         text_en:'Scope, location, and duration of Hot Work are clearly defined.',
         text_id:'Ruang lingkup, lokasi, dan durasi Hot Work didefinisikan dengan jelas.',
         possible:2},
        {docNo:3,
         text_en:'Risk assessment (JSA / HIRA) is completed and covers fire & explosion hazards.',
         text_id:'Risk assessment (JSA / HIRA) telah diselesaikan dan mencakup bahaya kebakaran & ledakan.',
         possible:3},
        {docNo:4,
         text_en:'Work team understands permit conditions and controls required before starting work.',
         text_id:'Tim kerja memahami persyaratan izin dan kontrol yang wajib dipenuhi sebelum memulai pekerjaan.',
         possible:2},
        {docNo:5,
         text_en:'Roles and responsibilities of Permit Issuer, Permit Receiver, and Fire Watch are clearly assigned.',
         text_id:'Peran dan tanggung jawab Permit Issuer, Permit Receiver, dan Fire Watch ditetapkan dengan jelas.',
         possible:2},
      ]
    },
    {
      key: 'housekeeping',
      name_en: 'Area Preparation & Housekeeping',
      name_id: 'Persiapan Area & Kebersihan',
      items: [
        {docNo:1,
         text_en:'Combustible materials (paper, cloth, plastics, wood, etc.) cleared within safe radius from sparks.',
         text_id:'Material mudah terbakar (kertas, kain, plastik, kayu, dll.) dibersihkan dari area berpotensi terkena percikan api.',
         possible:3},
        {docNo:2,
         text_en:'Flammable liquids and gas cylinders not used for the job are removed from work area.',
         text_id:'Cairan mudah menyala dan tabung gas yang tidak digunakan untuk pekerjaan dipindahkan dari area kerja.',
         possible:3},
        {docNo:3,
         text_en:'Drainage, trenches, and pits are inspected and free from flammable residues or vapors.',
         text_id:'Saluran, trench, dan pit diperiksa dan bebas dari residu atau uap mudah menyala.',
         possible:2},
        {docNo:4,
         text_en:'Fire blankets / spark curtains installed to protect adjacent equipment, cables, or openings.',
         text_id:'Selimut api / spark curtain terpasang untuk melindungi peralatan, kabel, atau bukaan di sekitar.',
         possible:2},
        {docNo:5,
         text_en:'All openings (doors, windows, cable trays, ducts) that may transmit sparks are protected or closed.',
         text_id:'Seluruh bukaan (pintu, jendela, cable tray, ducting) yang dapat menyalurkan percikan api telah dilindungi atau ditutup.',
         possible:2},
      ]
    },
    {
      key: 'gas_testing',
      name_en: 'Gas Testing & Atmosphere Control',
      name_id: 'Gas Testing & Kontrol Atmosfer',
      items: [
        {docNo:1,
         text_en:'Gas test performed before Hot Work in confined or enclosed spaces.',
         text_id:'Gas test dilakukan sebelum Hot Work di ruang terbatas atau ruang tertutup.',
         possible:3},
        {docNo:2,
         text_en:'Combustible gas concentration is within safe limit (below specified % LEL) before starting.',
         text_id:'Konsentrasi gas mudah terbakar berada dalam batas aman (di bawah % LEL yang ditentukan) sebelum pekerjaan dimulai.',
         possible:3},
        {docNo:3,
         text_en:'Oxygen level is within safe range (19.5‚Äì23.5%) during work in confined spaces.',
         text_id:'Kadar oksigen berada dalam rentang aman (19,5‚Äì23,5%) saat pekerjaan di ruang terbatas.',
         possible:2},
        {docNo:4,
         text_en:'Continuous or periodic gas testing is performed when required by permit.',
         text_id:'Gas test dilakukan secara kontinu atau berkala apabila dipersyaratkan dalam izin.',
         possible:2},
        {docNo:5,
         text_en:'Ventilation is adequate to remove fumes, smoke, and hot gases from the work area.',
         text_id:'Ventilasi memadai untuk mengeluarkan asap, uap, dan gas panas dari area kerja.',
         possible:2},
      ]
    },
    {
      key: 'equipment',
      name_en: 'Equipment & Hot Work Tools',
      name_id: 'Peralatan & Perkakas Hot Work',
      items: [
        {docNo:1,
         text_en:'Welding machines, cutting torches, and other Hot Work tools are in good condition.',
         text_id:'Mesin las, pemotong, dan perkakas Hot Work lain dalam kondisi baik.',
         possible:3},
        {docNo:2,
         text_en:'Cables, hoses, and connectors are free from damage, cracks, or exposed conductors.',
         text_id:'Kabel, selang, dan konektor bebas dari kerusakan, retak, atau konduktor terbuka.',
         possible:2},
        {docNo:3,
         text_en:'Return clamp (ground) is securely connected as close as possible to the work piece.',
         text_id:'Klem massa (ground) terpasang kuat sedekat mungkin dengan benda kerja.',
         possible:2},
        {docNo:4,
         text_en:'Acetylene, oxygen, and LPG hoses are clearly identified and connected correctly.',
         text_id:'Selang asetilena, oksigen, dan LPG teridentifikasi jelas dan terhubung dengan benar.',
         possible:2},
        {docNo:5,
         text_en:'Backflow prevention / flashback arresters are installed on gas lines where required.',
         text_id:'Backflow prevention / flashback arrester terpasang pada jalur gas sesuai persyaratan.',
         possible:2},
      ]
    },
    {
      key: 'fire_protection',
      name_en: 'Fire Protection & Emergency Preparedness',
      name_id: 'Proteksi Kebakaran & Kesiapsiagaan Darurat',
      items: [
        {docNo:1,
         text_en:'Fire extinguishers (type and quantity) are suitable for the Hot Work area.',
         text_id:'APAR (jenis dan jumlah) sesuai untuk area Hot Work.',
         possible:3},
        {docNo:2,
         text_en:'Fire extinguishers are located within easy reach of the work site.',
         text_id:'APAR ditempatkan dalam jangkauan mudah dari lokasi kerja.',
         possible:2},
        {docNo:3,
         text_en:'Fire hoses / hydrants are available and not obstructed, if applicable.',
         text_id:'Selang pemadam / hydrant tersedia dan tidak terhalang, bila ada.',
         possible:2},
        {docNo:4,
         text_en:'Extinguishers are checked regularly',
         text_id:'APAR diperiksa secara berkala', possible:2},
        {docNo:5,
         text_en:'Flashback arresters are installed on gas delivery hoses.',
         text_id:'Flashback arrester terpasang pada selang pengiriman gas.', possible:2},
        {docNo:6,
         text_en:'Fire hazard warning signs installed in potential fire locations',
         text_id:'Tanda peringatan bahaya kebakaran dipasang di lokasi potensi kebakaran', possible:2},
        {docNo:7,
         text_en:'Extinguishers are easily accessible and access to equipment is available',
         text_id:'APAR mudah diakses dan akses ke peralatan tersedia', possible:2},
        {docNo:8,
         text_en:'Extinguishers are in good condition (seals & locks intact, hoses not cracked, pressure in green zone, not expired)',
         text_id:'APAR dalam kondisi baik (segel & jarum pengunci utuh, selang tidak retak, tekanan di zona hijau, tidak kadaluarsa)', possible:2}
      ]
    },
    {
      key: 'fire_watch',
      name_en: 'Fire Watch & Supervision',
      name_id: 'Fire Watch & Pengawasan',
      items: [
        {docNo:1,
         text_en:'Fire Watch is assigned and present at the Hot Work location during activity.',
         text_id:'Fire Watch ditunjuk dan hadir di lokasi Hot Work selama aktivitas berlangsung.',
         possible:3},
        {docNo:2,
         text_en:'Fire Watch is equipped with communication tools (radio / phone) for emergency call.',
         text_id:'Fire Watch dilengkapi alat komunikasi (radio / telepon) untuk pemanggilan darurat.',
         possible:2},
        {docNo:3,
         text_en:'Fire Watch understands locations of emergency exits, alarms, and firefighting equipment.',
         text_id:'Fire Watch memahami lokasi jalur evakuasi, alarm, dan peralatan pemadam kebakaran.',
         possible:2},
        {docNo:4,
         text_en:'Fire Watch remains on site during Hot Work and stays for a specified period after work completion.',
         text_id:'Fire Watch tetap berada di lokasi selama Hot Work dan bertahan dalam periode tertentu setelah pekerjaan selesai.',
         possible:2},
        {docNo:5,
         text_en:'Supervision verifies that work area is safe and permit is closed after Hot Work completion.',
         text_id:'Pengawas memastikan area kerja aman dan izin kerja ditutup setelah Hot Work selesai.',
         possible:2},
      ]
    },
    {
      key: 'post_work',
      name_en: 'Post-Work Inspection & Housekeeping',
      name_id: 'Inspeksi Pasca Pekerjaan & Housekeeping',
      items: [
        {docNo:1,
         text_en:'Work area is inspected immediately after completion of Hot Work for any smoldering materials.',
         text_id:'Area kerja diperiksa segera setelah Hot Work selesai untuk memastikan tidak ada material yang masih membara.',
         possible:3},
        {docNo:2,
         text_en:'Follow-up inspection is performed after a defined watch period (e.g. 30‚Äì60 minutes).',
         text_id:'Inspeksi lanjutan dilakukan setelah periode pengawasan tertentu (misal 30‚Äì60 menit).',
         possible:2},
        {docNo:3,
         text_en:'Tools, cables, and gas cylinders are removed or stored safely after work.',
         text_id:'Peralatan, kabel, dan tabung gas dilepas atau disimpan dengan aman setelah pekerjaan.',
         possible:2},
        {docNo:4,
         text_en:'Permit is signed off and filed according to procedure.',
         text_id:'Izin kerja ditutup dan diarsipkan sesuai prosedur.',
         possible:2},
        {docNo:5,
         text_en:'Lessons learned / improvement actions are recorded if any deviation or near miss occurs.',
         text_id:'Lessons learned / tindakan perbaikan dicatat jika terjadi deviasi atau near miss.',
         possible:2},
      ]
    }
  ];

  const state = {
    lang: 'en',
    auditor: '',
    date: '',
    search: '',
    filterCategory: 'all',
    filterStatus: 'all',
    values: {},
  };

  let highlightIssues = false;

  function toast(msg){
    alert(msg);
  }

  function getSavedItem(categoryKey, index){
    const key = `${categoryKey}_${index}`;
    if(!state.values[key]){
      state.values[key] = { actual: '', na: false, findings: '', photos: [] };
    }
    return state.values[key];
  }

  function updateScore(){
    let totalPossible = 0;
    let totalActual = 0;

    CATEGORIES.forEach(cat=>{
      cat.items.forEach((it,idx)=>{
        const saved = getSavedItem(cat.key, idx);
        const maxP = it.possible;
        totalPossible += maxP;

        if(!saved.na && saved.actual){
          const val = Number(saved.actual)||0;
          totalActual += val;
        }
      });
    });

    const pct = totalPossible ? Math.round((totalActual/totalPossible)*100) : 0;
    const T = TRANSLATIONS[state.lang];

    document.getElementById('kpiPossible').textContent = totalPossible;
    document.getElementById('kpiActual').textContent = totalActual;
    document.getElementById('kpiPct').textContent = pct + '%';

    let rating = '';
    if(pct >= 90) rating = T.rating_excellent;
    else if(pct >= 75) rating = T.rating_good;
    else if(pct >= 60) rating = T.rating_need_improvement;
    else rating = T.rating_critical;

    document.getElementById('kpiRating').textContent = rating;
    document.getElementById('progressFill').style.width = pct + '%';
    document.getElementById('globalSummary').textContent =
      T.global_summary(totalActual, totalPossible, pct, rating);
  }

  function applyFilters(){
    const cards = document.querySelectorAll('[data-card]');
    const search = state.search.toLowerCase();
    const catFilter = state.filterCategory;
    const statusFilter = state.filterStatus;

    cards.forEach(card=>{
      const txt = card.getAttribute('data-text') || '';
      const cat = card.getAttribute('data-category') || '';
      const status = card.getAttribute('data-status') || '';

      let show = true;

      if(search && !txt.includes(search)) show = false;
      if(catFilter !== 'all' && cat !== catFilter) show = false;
      if(statusFilter !== 'all' && status !== statusFilter) show = false;

      card.style.display = show ? '' : 'none';
    });
  }

  function render(){
    const section = document.getElementById('cardsSection');
    section.innerHTML = '';

    const T = TRANSLATIONS[state.lang];

    document.title = T.title;
    document.getElementById('heroDesc').textContent = T.hero_desc;
    document.getElementById('chipScopeLabel').textContent = T.chip_scope_label;
    document.getElementById('chipScopeText').textContent = T.chip_scope_text;
    document.getElementById('chipProgramLabel').textContent = T.chip_program_label;
    document.getElementById('chipProgramText').textContent = T.chip_program_text;
    document.getElementById('chipOwnerLabel').textContent = T.chip_owner_label;
    document.getElementById('chipOwnerText').textContent = T.chip_owner_text;
    document.getElementById('pillHraText').textContent = T.pill_hra_text;
    document.getElementById('pillComplianceText').textContent = T.pill_compliance_text;
    document.getElementById('pillLearningText').textContent = T.pill_learning_text;
    document.getElementById('tagLabel').textContent = T.tag_label;
    document.getElementById('tagSub').textContent = T.tag_sub;
    document.getElementById('badge_info').textContent = T.badge_info;
    document.getElementById('btn_issues').textContent = T.btn_issues_label;
    document.getElementById('btn_save').textContent = T.btn_save_label;
    document.getElementById('btn_print').textContent = T.btn_print_label;
    document.getElementById('btn_csv').textContent = T.btn_csv_label;
    document.getElementById('btn_reset').textContent = T.btn_reset_label;

    document.getElementById('footerNote').textContent = T.footer_note;
    document.getElementById('lbl_identity').textContent = T.lbl_identity;
    document.getElementById('inputAuditor').placeholder = T.input_auditor_ph;
    document.getElementById('inputSearch').placeholder = T.input_search;

    const filterCat = document.getElementById('filterCategory');
    filterCat.innerHTML = `<option value="all">${T.filter_all_cat}</option>`;
    CATEGORIES.forEach(cat=>{
      const name = state.lang==='en'?cat.name_en:cat.name_id;
      const opt = document.createElement('option');
      opt.value = cat.key;
      opt.textContent = name;
      filterCat.appendChild(opt);
    });

    const filterStatus = document.getElementById('filterStatus');
    filterStatus.innerHTML = `
      <option value="all">${T.filter_all_stat}</option>
      <option value="complete">${T.filter_complete}</option>
      <option value="na">${T.filter_na}</option>
      <option value="empty">${T.filter_empty}</option>
    `;

    document.getElementById('kpi_possible').textContent = T.kpi_possible;
    document.getElementById('kpi_actual').textContent = T.kpi_actual;
    document.getElementById('kpi_score').textContent = T.kpi_score;

    CATEGORIES.forEach(cat=>{
      const catName = state.lang==='en'?cat.name_en:cat.name_id;

      cat.items.forEach((it,idx)=>{
        const key = `${cat.key}_${idx}`;
        const saved = getSavedItem(cat.key, idx);

        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('data-card','true');
        card.setAttribute('data-category',cat.key);

        const textAll = (it.text_en + ' ' + it.text_id).toLowerCase();
        card.setAttribute('data-text', textAll);

        const status = saved.na ? 'na' : (saved.actual ? 'complete' : 'empty');
        card.setAttribute('data-status', status);
        if(highlightIssues && (status === 'na' || (Number(saved.actual || 0) < it.possible))){
          card.classList.add('issue');
        }

        const head = document.createElement('div');
        head.className = 'head';

        const titleBox = document.createElement('div');
        titleBox.className = 'title';

        const h2 = document.createElement('h2');
        h2.textContent = `${catName} ‚Äî #${it.docNo}`;
        const sub = document.createElement('div');
        sub.className = 'subtitle';
        sub.textContent = state.lang==='en'?it.text_en:it.text_id;

        titleBox.appendChild(h2);
        titleBox.appendChild(sub);

        const badge = document.createElement('div');
        badge.className = 'badge';
        badge.textContent = `${T.card_actual}: ${saved.na?'N/A':(saved.actual||0)} / ${it.possible}`;

        head.appendChild(titleBox);
        head.appendChild(badge);

        const body = document.createElement('div');
        body.className = 'body';

        const statusRow = document.createElement('div');
        statusRow.className = 'status-row';

        const label = document.createElement('label');
        label.textContent = T.card_status;

        const select = document.createElement('select');
        select.innerHTML = `
          <option value="app">${T.opt_app}</option>
          <option value="na">${T.opt_na}</option>
        `;
        select.value = saved.na?'na':'app';

        const scoreRow = document.createElement('div');
        scoreRow.className = 'score-row';

        const input = document.createElement('input');
        input.type = 'number';
        input.value = saved.na ? '' : (saved.actual||'');
        input.min = '0';
        input.max = String(it.possible);
        input.placeholder = '0';

        const possibleText = document.createElement('div');
        possibleText.className = 'possible-text';
        possibleText.textContent = `${T.card_actual}: max ${it.possible}`;

        scoreRow.appendChild(input);
        scoreRow.appendChild(possibleText);

        statusRow.appendChild(label);
        statusRow.appendChild(select);

        const findingsLabel = document.createElement('label');
        findingsLabel.textContent = T.card_findings;

        const textarea = document.createElement('textarea');
        textarea.placeholder = T.card_findings_ph;
        textarea.value = saved.findings || '';

        const photoRow = document.createElement('div');
        photoRow.className = 'photo-row';

        const photoInfo = document.createElement('div');
        photoInfo.textContent = `${T.card_photo}: ${(saved.photos||[]).length} file(s)`;

        const photoBtn = document.createElement('button');
        photoBtn.type = 'button';
        photoBtn.innerHTML = `<span>üìé</span><span>${T.card_photo_btn}</span>`;

        statusRow.appendChild(scoreRow);
        body.appendChild(statusRow);
        body.appendChild(findingsLabel);
        body.appendChild(textarea);
        body.appendChild(photoRow);
        photoRow.appendChild(photoInfo);
        photoRow.appendChild(photoBtn);

        card.appendChild(head);
        card.appendChild(body);
        section.appendChild(card);

        select.addEventListener('change', ()=>{
          const val = select.value;
          const savedItem = getSavedItem(cat.key, idx);
          if(val === 'na'){
            savedItem.na = true;
            input.value = '';
            savedItem.actual = '';
          } else {
            savedItem.na = false;
          }
          const st = savedItem.na ? 'na' : (savedItem.actual ? 'complete' : 'empty');
          card.setAttribute('data-status',st);
          badge.textContent = `${T.card_actual}: ${savedItem.na?'N/A':(savedItem.actual||0)} / ${it.possible}`;
          if(savedItem.na || (Number(savedItem.actual||0) < it.possible)){
            card.classList.add('issue');
          }else{
            card.classList.remove('issue');
          }
          updateScore();
          applyFilters();
        });

        input.addEventListener('input', ()=>{
          const savedItem = getSavedItem(cat.key, idx);
          let v = input.value === '' ? '' : Number(input.value);
          if(v === ''){
            savedItem.actual = '';
          } else {
            if(v < 0){
              toast(TRANSLATIONS[state.lang].msg_neg);
              v = 0;
            }
            if(v > it.possible){
              toast(TRANSLATIONS[state.lang].msg_max + ' ' + it.possible);
              v = it.possible;
            }
            input.value = v;
            savedItem.actual = v;
          }
          savedItem.na = false;
          select.value = 'app';

          const st = savedItem.na ? 'na' : (savedItem.actual ? 'complete' : 'empty');
          card.setAttribute('data-status',st);
          badge.textContent = `${T.card_actual}: ${savedItem.na?'N/A':(savedItem.actual||0)} / ${it.possible}`;
          if(savedItem.na || (Number(savedItem.actual||0) < it.possible)){
            card.classList.add('issue');
          }else{
            card.classList.remove('issue');
          }
          updateScore();
          applyFilters();
        });

        textarea.addEventListener('input', ()=>{
          const savedItem = getSavedItem(cat.key, idx);
          savedItem.findings = textarea.value;
        });

        photoBtn.addEventListener('click', ()=>{
          const current = getSavedItem(cat.key, idx);
          const desc = prompt('Describe file name / path or reference for photo evidence:', '');
          if(desc){
            current.photos = current.photos || [];
            current.photos.push(desc);
            photoInfo.textContent = `${T.card_photo}: ${(current.photos||[]).length} file(s)`;
          }
        });
      });
    });

    updateScore();
    applyFilters();
  }

  function resetAll(){
    if(!confirm('Reset all data in this form?')) return;
    Object.keys(state.values).forEach(k=>delete state.values[k]);
    state.search = '';
    state.filterCategory = 'all';
    state.filterStatus = 'all';
    document.getElementById('inputSearch').value = '';
    document.getElementById('filterCategory').value = 'all';
    document.getElementById('filterStatus').value = 'all';
    render();
  }

  function doPrint(){
    window.print();
  }

  function validateExport(){
    const T = TRANSLATIONS[state.lang];
    const missing = [];

    CATEGORIES.forEach(cat=>{
      cat.items.forEach((it,idx)=>{
        const saved = getSavedItem(cat.key, idx);
        if(saved.na && !(saved.findings && saved.findings.trim())){
          const name = state.lang==='en'?cat.name_en:cat.name_id;
          missing.push(`${name} #${it.docNo}`);
        }
      });
    });
    if(missing.length){
      alert(T.msg_export + '\n\n' + missing.join('\n'));
      return false;
    }
    return true;
  }

  function exportCSV(){
    if(!validateExport()) return;
    const T = TRANSLATIONS[state.lang];
    const rows = [[
      state.lang==='id'?'Kategori':'Category',
      'No',
      state.lang==='id'?'Pertanyaan (ID)':'Question (EN)',
      'Possible',
      'Actual',
      'Status',
      state.lang==='id'?'Temuan':'Findings',
      'PhotoCount'
    ]];

    CATEGORIES.forEach(cat=>{
      const catName = state.lang==='en'?cat.name_en:cat.name_id;
      cat.items.forEach((it,idx)=>{
        const saved = getSavedItem(cat.key, idx);
        const status = saved.na ? 'N/A' : (saved.actual ? 'Completed' : 'Empty');
        rows.push([
          catName,
          it.docNo,
          state.lang==='en'?it.text_en:it.text_id,
          it.possible,
          saved.na?'':(saved.actual||''),
          status,
          saved.findings||'',
          (saved.photos||[]).length
        ]);
      });
    });

    let csv = rows.map(r=>r.map(x=>{
      const s = (x===null||x===undefined)?'':String(x);
      if(s.includes(',') || s.includes('"')){
        return `"${s.replace(/"/g,'""')}"`;
      }
      return s;
    }).join(',')).join('\r\n');

    const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = 'HRA_Audit_HotWork_FirePrevention.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function buildPayloadForSave(){
    const auditorInput = (document.getElementById('inputAuditor').value||'').trim();
    const dateInput = document.getElementById('inputDate').value || '';
    if(!auditorInput){
      alert('Please fill auditor name before saving.');
      return null;
    }
    if(!dateInput){
      alert('Please pick audit date before saving.');
      return null;
    }
    const now = new Date();
    const pad = n=>String(n).padStart(2,'0');
    const auditId = `HRAHW-${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}-${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}`;

    let lastAuditId = auditId;

    const records = [];
    CATEGORIES.forEach(cat=>{
      const catNameEn = cat.name_en;
      const catNameId = cat.name_id;
      cat.items.forEach((it, idx)=>{
        const saved = getSavedItem(cat.key, idx);
        const maxP = it.possible;
        let actual = saved.na ? null : (saved.actual === '' ? null : Number(saved.actual)||0);

        records.push({
          auditId: lastAuditId,
          categoryKey: cat.key,
          categoryName_en: catNameEn,
          categoryName_id: catNameId,
          no: it.docNo,
          question_en: it.text_en,
          question_id: it.text_id,
          possiblePoint: maxP,
          actualPoint: actual,
          status: saved.na ? 'N/A' : 'Applicable',
          findings: saved.findings || '',
          photoEvidence: saved.photos || []
        });
      });
    });

    return {
      auditId: lastAuditId,
      auditorName: auditorInput,
      auditDate: dateInput,
      records
    };
  }

  async function saveToServer(){
    const core = buildPayloadForSave();
    if(!core) return;

    const payload = {
      form: 'HRA_AUDIT_HOTWORK_FIRE_PREVENTION',
      auditor: core.auditorName,
      date:    core.auditDate,
      auditId: core.auditId,
      records: core.records
    };

    try{
      const res = await fetch(API_SAVE_URL,{
        method:'POST',
        // biarkan header default (text/plain) agar tidak memicu preflight CORS
        body:JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('HTTP '+res.status);
      const result = await res.json();
      if(!result.ok) throw new Error(result.error || 'Unknown error from API');
      const count = result.records ?? core.records.length;
      toast((state.lang==='id'
        ? `Tersimpan ${count} baris. Audit ID: `
        : `Saved ${count} rows. Audit ID: `) + core.auditId);
    }catch(err){
      console.error(err);
      alert('Failed to save to server: '+err.message);
    }
  }

  render();

  document.getElementById('inputAuditor').addEventListener('input', e=>{
    state.auditor = e.target.value;
  });
  document.getElementById('inputDate').addEventListener('change', e=>{
    state.date = e.target.value;
    render();
  });

  document.getElementById('inputSearch').addEventListener('input', e=>{
    state.search = e.target.value;
    applyFilters();
  });
  document.getElementById('filterCategory').addEventListener('change', e=>{
    state.filterCategory = e.target.value;
    applyFilters();
  });
  document.getElementById('filterStatus').addEventListener('change', e=>{
    state.filterStatus = e.target.value;
    applyFilters();
  });

  document.getElementById('btnSave').addEventListener('click', saveToServer);
  document.getElementById('btnPrint').addEventListener('click', doPrint);
  document.getElementById('btnExportCsv').addEventListener('click', exportCSV);
  document.getElementById('btnReset').addEventListener('click', resetAll);
  document.getElementById('btnIssues').addEventListener('click', ()=>{
    highlightIssues = !highlightIssues;
    document.body.classList.toggle('issues-on', highlightIssues);
    document.getElementById('btnIssues').classList.toggle('toggle-active', highlightIssues);
    applyFilters();
  });

  document.getElementById('btnLangEn').addEventListener('click', ()=>{
    state.lang = 'en';
    document.getElementById('btnLangEn').classList.add('active');
    document.getElementById('btnLangId').classList.remove('active');
    render();
  });
  document.getElementById('btnLangId').addEventListener('click', ()=>{
    state.lang = 'id';
    document.getElementById('btnLangId').classList.add('active');
    document.getElementById('btnLangEn').classList.remove('active');
    render();
  });

</script>

</body>
</html>
